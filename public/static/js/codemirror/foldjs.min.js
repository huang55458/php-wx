!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(d){function c(g,m,s,j){if(s&&s.call){var h=s;s=null}else{h=a(g,s,"rangeFinder")}"number"==typeof m&&(m=d.Pos(m,0));var k=a(g,s,"minFoldSize");function n(l){var f=h(g,m);if(!f||f.to.line-f.from.line<k){return null}for(var e=g.findMarksAt(f.from),i=0;i<e.length;++i){if(e[i].__isFold&&"fold"!==j){if(!l){return null}f.cleared=!0,e[i].clear()}}return f}var r=n(!0);if(a(g,s,"scanUp")){for(;!r&&m.line>g.firstLine();){m=d.Pos(m.line-1,0),r=n(!1)}}if(r&&!r.cleared&&"unfold"!==j){var q=function(w,v,u){var l=a(w,v,"widget");"function"==typeof l&&(l=l(u.from,u.to));if("string"==typeof l){var f=document.createTextNode(l);(l=document.createElement("span")).appendChild(f),l.className="CodeMirror-foldmarker"}else{l&&(l=l.cloneNode(!0))}return l}(g,s,r);d.on(q,"mousedown",function(e){p.clear(),d.e_preventDefault(e)});var p=g.markText(r.from,r.to,{replacedWith:q,clearOnEnter:a(g,s,"clearOnEnter"),__isFold:!0});p.on("clear",function(i,f){d.signal(g,"unfold",g,i,f)}),d.signal(g,"fold",g,r.from,r.to)}}d.newFoldFunction=function(g,f){return function(h,e){c(h,e,{rangeFinder:g,widget:f})}},d.defineExtension("foldCode",function(h,g,f){c(this,h,g,f)}),d.defineExtension("isFolded",function(h){for(var g=this.findMarksAt(h),f=0;f<g.length;++f){if(g[f].__isFold){return !0}}}),d.commands.toggleFold=function(e){e.foldCode(e.getCursor())},d.commands.fold=function(e){e.foldCode(e.getCursor(),null,"fold")},d.commands.unfold=function(e){e.foldCode(e.getCursor(),null,"unfold")},d.commands.foldAll=function(e){e.operation(function(){for(var g=e.firstLine(),f=e.lastLine();g<=f;g++){e.foldCode(d.Pos(g,0),null,"fold")}})},d.commands.unfoldAll=function(e){e.operation(function(){for(var g=e.firstLine(),f=e.lastLine();g<=f;g++){e.foldCode(d.Pos(g,0),null,"unfold")}})},d.registerHelper("fold","combine",function(){var e=Array.prototype.slice.call(arguments,0);return function(i,h){for(var g=0;g<e.length;++g){var f=e[g](i,h);if(f){return f}}}}),d.registerHelper("fold","auto",function(j,i){for(var h=j.getHelpers(i,"fold"),g=0;g<h.length;g++){var f=h[g](j,i);if(f){return f}}});var b={rangeFinder:d.fold.auto,widget:"â†”",minFoldSize:0,scanUp:!1,clearOnEnter:!0};function a(h,g,f){if(g&&void 0!==g[f]){return g[f]}var e=h.options.foldOptions;return e&&void 0!==e[f]?e[f]:b[f]}d.defineOption("foldOptions",null),d.defineExtension("foldOption",function(f,e){return a(this,f,e)})});!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],a):a(CodeMirror)}(function(x){x.defineOption("foldGutter",!1,function(c,a,d){d&&d!=x.Init&&(c.clearGutter(c.state.foldGutter.options.gutter),c.state.foldGutter=null,c.off("gutterClick",q),c.off("changes",w),c.off("viewportChange",j),c.off("fold",s),c.off("unfold",s),c.off("swapDoc",w)),a&&(c.state.foldGutter=new p(function(e){!0===e&&(e={});null==e.gutter&&(e.gutter="CodeMirror-foldgutter");null==e.indicatorOpen&&(e.indicatorOpen="CodeMirror-foldgutter-open");null==e.indicatorFolded&&(e.indicatorFolded="CodeMirror-foldgutter-folded");return e}(a)),v(c),c.on("gutterClick",q),c.on("changes",w),c.on("viewportChange",j),c.on("fold",s),c.on("unfold",s),c.on("swapDoc",w))});var g=x.Pos;function p(a){this.options=a,this.from=this.to=0}function b(c,f){for(var d=c.findMarks(g(f,0),g(f+1,0)),l=0;l<d.length;++l){if(d[l].__isFold){var a=d[l].find(-1);if(a&&a.line===f){return d[l]}}}}function h(a){if("string"==typeof a){var c=document.createElement("div");return c.className=a+" CodeMirror-guttermarker-subtle",c}return a.cloneNode(!0)}function k(B,o,n){var z=B.state.foldGutter.options,r=o-1,A=B.foldOption(z,"minFoldSize"),f=B.foldOption(z,"rangeFinder"),y="string"==typeof z.indicatorFolded&&m(z.indicatorFolded),C="string"==typeof z.indicatorOpen&&m(z.indicatorOpen);B.eachLine(o,n,function(t){++r;var c=null,d=t.gutterMarkers;if(d&&(d=d[z.gutter]),b(B,r)){if(y&&d&&y.test(d.className)){return}c=h(z.indicatorFolded)}else{var l=g(r,0),a=f&&f(B,l);if(a&&a.to.line-a.from.line>=A){if(C&&d&&C.test(d.className)){return}c=h(z.indicatorOpen)}}(c||d)&&B.setGutterMarker(t,z.gutter,c)})}function m(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function v(a){var d=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){k(a,d.from,d.to)}),c.from=d.from,c.to=d.to)}function q(l,r,u){var d=l.state.foldGutter;if(d){var o=d.options;if(u==o.gutter){var c=b(l,r);c?c.clear():l.foldCode(g(r,0),o)}}}function w(a){var d=a.state.foldGutter;if(d){var c=d.options;d.from=d.to=0,clearTimeout(d.changeUpdate),d.changeUpdate=setTimeout(function(){v(a)},c.foldOnChangeTimeSpan||600)}}function j(a){var d=a.state.foldGutter;if(d){var c=d.options;clearTimeout(d.changeUpdate),d.changeUpdate=setTimeout(function(){var f=a.getViewport();d.from==d.to||f.from-d.to>20||d.from-f.to>20?v(a):a.operation(function(){f.from<d.from&&(k(a,f.from,d.from),d.from=f.from),f.to>d.to&&(k(a,d.to,f.to),d.to=f.to)})},c.updateViewportTimeSpan||400)}}function s(a,f){var d=a.state.foldGutter;if(d){var c=f.line;c>=d.from&&c<d.to&&k(a,c,c+1)}}});!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){a.registerHelper("fold","brace",function(w,z){var j,D=z.line,y=w.getLine(D);function B(c){for(var i=z.ch,g=0;;){var d=i<=0?-1:y.lastIndexOf(c,i-1);if(-1!=d){if(1==g&&d<z.ch){break}if(j=w.getTokenTypeAt(a.Pos(D,d+1)),!/^(comment|string)/.test(j)){return d+1}i=d-1}else{if(1==g){break}g=1,i=y.length}}}var F="{",q="}",h=B("{");if(null==h&&(F="[",q="]",h=B("[")),null!=h){var I,G,H=1,E=w.lastLine();a:for(var e=D;e<=E;++e){for(var x=w.getLine(e),A=e==D?h:0;;){var b=x.indexOf(F,A),C=x.indexOf(q,A);if(b<0&&(b=x.length),C<0&&(C=x.length),(A=Math.min(b,C))==x.length){break}if(w.getTokenTypeAt(a.Pos(e,A+1))==j){if(A==b){++H}else{if(!--H){I=e,G=A;break a}}}++A}}if(null!=I&&D!=I){return{from:a.Pos(D,h),to:a.Pos(I,G)}}}}),a.registerHelper("fold","import",function(g,k){function d(r){if(r<g.firstLine()||r>g.lastLine()){return null}var p=g.getTokenAt(a.Pos(r,1));if(/\S/.test(p.string)||(p=g.getTokenAt(a.Pos(r,p.end+1))),"keyword"!=p.type||"import"!=p.string){return null}for(var m=r,q=Math.min(g.lastLine(),r+10);m<=q;++m){var f=g.getLine(m).indexOf(";");if(-1!=f){return{startCh:p.end,end:a.Pos(m,f)}}}}var c,j=k.line,b=d(j);if(!b||d(j-1)||(c=d(j-2))&&c.end.line==j-1){return null}for(var h=b.end;;){var e=d(h.line+1);if(null==e){break}h=e.end}return{from:g.clipPos(a.Pos(j,b.startCh+1)),to:h}}),a.registerHelper("fold","include",function(e,g){function d(i){if(i<e.firstLine()||i>e.lastLine()){return null}var h=e.getTokenAt(a.Pos(i,1));return/\S/.test(h.string)||(h=e.getTokenAt(a.Pos(i,h.end+1))),"meta"==h.type&&"#include"==h.string.slice(0,8)?h.start+8:void 0}var c=g.line,f=d(c);if(null==f||null!=d(c-1)){return null}for(var b=c;;){if(null==d(b+1)){break}++b}return{from:a.Pos(c,f+1),to:e.clipPos(a.Pos(b))}})});